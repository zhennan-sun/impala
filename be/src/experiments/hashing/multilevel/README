This is the multilevel fanout code. Doesn't have streaming or the abstracted interface. Doesn't have recursion unrolled.
