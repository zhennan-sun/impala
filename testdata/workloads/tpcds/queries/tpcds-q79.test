====
---- QUERY: TPCDS-Q79
select
  c_last_name,
  c_first_name,
  substr(s_city, 1, 30),
  ss_ticket_number,
  amt,
  profit
from
  (select
    ss_ticket_number,
    ss_customer_sk,
    store.s_city,
    sum(ss_coupon_amt) amt,
    sum(ss_net_profit) profit
  from
    store_sales,
    date_dim,
    store,
    household_demographics
  where
    store_sales.ss_sold_date_sk = date_dim.d_date_sk
    and store_sales.ss_store_sk = store.s_store_sk
    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk
    and (household_demographics.hd_dep_count = 8
      or household_demographics.hd_vehicle_count > 0)
    -- and date_dim.d_dow = 1
    -- and date_dim.d_year in (1998, 1998 + 1, 1998 + 2)
    and store.s_number_employees between 200 and 295
    -- partition key filter
    -- and ss_sold_date_sk in (2450819, 2450826, 2450833, 2450840, 2450847, 2450854, 2450861, 2450868, 2450875, 2450882, 2450889,
    -- 2450896, 2450903, 2450910, 2450917, 2450924, 2450931, 2450938, 2450945, 2450952, 2450959, 2450966, 2450973, 2450980, 2450987,
    -- 2450994, 2451001, 2451008, 2451015, 2451022, 2451029, 2451036, 2451043, 2451050, 2451057, 2451064, 2451071, 2451078, 2451085,
    -- 2451092, 2451099, 2451106, 2451113, 2451120, 2451127, 2451134, 2451141, 2451148, 2451155, 2451162, 2451169, 2451176, 2451183,
    -- 2451190, 2451197, 2451204, 2451211, 2451218, 2451225, 2451232, 2451239, 2451246, 2451253, 2451260, 2451267, 2451274, 2451281,
    -- 2451288, 2451295, 2451302, 2451309, 2451316, 2451323, 2451330, 2451337, 2451344, 2451351, 2451358, 2451365, 2451372, 2451379,
    -- 2451386, 2451393, 2451400, 2451407, 2451414, 2451421, 2451428, 2451435, 2451442, 2451449, 2451456, 2451463, 2451470, 2451477,
    -- 2451484, 2451491, 2451498, 2451505, 2451512, 2451519, 2451526, 2451533, 2451540, 2451547, 2451554, 2451561, 2451568, 2451575,
    -- 2451582, 2451589, 2451596, 2451603, 2451610, 2451617, 2451624, 2451631, 2451638, 2451645, 2451652, 2451659, 2451666, 2451673,
    -- 2451680, 2451687, 2451694, 2451701, 2451708, 2451715, 2451722, 2451729, 2451736, 2451743, 2451750, 2451757, 2451764, 2451771,
    -- 2451778, 2451785, 2451792, 2451799, 2451806, 2451813, 2451820, 2451827, 2451834, 2451841, 2451848, 2451855, 2451862, 2451869,
    -- 2451876, 2451883, 2451890, 2451897, 2451904)    
    and d_date between '1999-01-01' and '1999-03-31'
    and ss_sold_date_sk between 2451180 and 2451269  -- partition key filter
  group by
    ss_ticket_number,
    ss_customer_sk,
    ss_addr_sk,
    store.s_city
  ) ms,
  customer
where
  ss_customer_sk = c_customer_sk
order by
  c_last_name,
  c_first_name,
  substr(s_city, 1, 30),
  profit
limit 100;
---- RESULTS
'','','Midway',9315,6637.960174560547,-19053.0099401474
'','','Midway',185660,3594.460105895996,-13505.76986312866
'','','Midway',82061,1343.620032310486,-9218.880016326904
'','','Midway',78302,2371.409942626953,-7625.249889373779
'','','Midway',110272,1671.169998168945,-5792.100067138672
'','','Midway',100922,405.3499927520752,-3542.15994644165
'','','Midway',147115,1123.630004882812,-2803.729888916016
'','','Midway',36631,15.24000024795532,5080.829958438873
'','','Midway',185660,0,NULL
'','Aisha','Midway',105333,227.3000068664551,1235.419952392578
'','David','Midway',108460,3969.159927368164,-17644.12011909485
'','Edward','Midway',62697,463.3900122046471,-3857.539993286133
'','John','Midway',145005,438.0899963378906,-2708.170139312744
'','Laura','Midway',42843,231.6000061035156,2662.770055770874
'','Lawrence','Midway',46950,32.63000106811523,1456.900024414062
'','Linda','Fairview',208936,0,-15585.84992218018
'','Malinda','Midway',55959,7606.169921875,-9597.490219116211
'','Marilyn','Fairview',31190,191.9400024414062,-7049.73978805542
'','Nydia','Midway',88008,1084.710006713867,-1912.169998168945
'','Nydia','Midway',88008,0,NULL
'','Randy','Midway',200913,0,-14249.78002548218
'','Robert','Midway',227572,0,-13903.86989116669
'','Wallace','Midway',6920,0,-4356.03010559082
'Acevedo','Grace','Midway',138006,167.1700057983398,-1954.45002746582
'Adair','David','Midway',99374,10343.3801612854,-17501.58046722412
'Adams','Beth','Midway',73934,2148.450042724609,-9147.510213851929
'Aguilar','Douglas','Midway',79385,0,-8233.530067443848
'Alexander','Annie','Midway',72228,798.9799976348877,-7804.330108642578
'Allen','Jack','Midway',58268,0,-3681.160007476807
'Allison','Elsie','Midway',201869,132.9600067138672,-3760.829940795898
'Amundson','Ernest','Midway',228272,8218.460193634033,-4039.619958877563
'Anderson','Alan','Midway',31774,3141.000022888184,-3937.229975700378
'Anderson','Anabel','Fairview',173521,0,-8390.179962158203
'Anderson','Gerald','Midway',161201,0,-12656.36991119385
'Anderson','Louis','Midway',2413,2478.75,-15660.78997421265
'Andrews','Katrina','Midway',141027,949.6100158691406,-13883.29990768433
'Arnold','Sueann','Midway',236454,934.6099945008755,-9877.859778314829
'Ashby','Cody','Fairview',227058,2495.040013313293,-14773.02006912231
'Atkins','Margaret','Midway',55771,2935.950019836426,-14653.77972412109
'Austin','Jane','Midway',85459,0,-11628.79001617432
'Bailey','Noble','Fairview',166211,233.6199951171875,-8209.440061569214
'Bailey','Robert','Midway',234709,3214.38005065918,-17040.31006622314
'Baker','Cynthia','Midway',211345,22.73999977111816,-358.8400287628174
'Baker','Cynthia','Midway',211345,NULL,NULL
'Banks','Bobby','Midway',89949,1314.2900390625,-601.3600330352783
'Banks','Max','Midway',219523,0,2428.839936256409
'Barnett','Ramiro','Midway',160660,0,-2120.119987487793
'Barrett','','Midway',209036,2318.799978256226,-9957.729940414429
'Belcher','Kristina','Midway',185205,8.130000114440918,-6758.129814147949
'Bell','Allen','Midway',192379,413.9100036621094,-5402.120041012764
'Bell','Judith','Midway',214325,1703.860000610352,-12327.70021820068
'Beltran','Scott','Midway',65875,6418.029937744141,-25914.45983123779
'Bennett','Marvin','Midway',127326,0,-4824.980026245117
'Bernal','Nilda','Midway',163603,2896.7099609375,-351.7700657844543
'Bilodeau','Angela','Midway',140268,1334.339981079102,-9793.019975662231
'Bishop','Gregg','Midway',214893,415.0700149536133,-15794.60003662109
'Boudreaux','John','Midway',99169,2028.149955749512,-17410.66997528076
'Bradford','Joseph','Fairview',43264,495.1900024414062,-11751.04970550537
'Bradley','Eric','Fairview',43135,5818.089767456055,-5982.449836730957
'Brill','Christina','Midway',232415,633.1200256347656,-11857.99995422363
'Brooks','Jeannie','Fairview',7310,1083.549989700317,-7109.820038795471
'Brown','Dorothy','Midway',40763,4618.290122509003,-3641.150020599365
'Brown','Many','Fairview',227538,4310.769966125488,-9102.139949798584
'Brown','Terry','Midway',40734,0,-237.2398223876953
'Bruce','Edward','Midway',57609,3006.200073242188,-15319.85997319221
'Bullock','Kathryn','Midway',128851,0,201.8600635528564
'Burger','Don','Midway',237223,2047.830062866211,-859.1200485229492
'Burgess','Andrew','Midway',24111,2946.860092163086,2954.260065078735
'Burke','Molly','Fairview',128688,1935.129959106445,-14460.0799741745
'Burns','Betsy','Midway',39637,209.5599975585938,-3769.660064697266
'Burns','Michell','Midway',31432,2705.1298828125,-13436.17947340012
'Butler','Karen','Midway',204442,0,-2323.929862976074
'Byrd','Jason','Midway',81091,878.2800140380859,-8828.840133666992
'Byrne','Tamara','Midway',67601,2392.909896850586,-8827.789932250977
'Calhoun','George','Midway',91645,3083.249893188477,-18583.67997741699
'Call','Edward','Midway',116662,2367.800067901611,-11636.17000484467
'Camp','Nancy','Midway',183894,2207.299991607666,-7435.099680900574
'Cannon','Richard','Midway',118336,3498.36003112793,-9718.320032119751
'Carr','Celeste','Midway',25783,1139.640037536621,-2973.510046958923
'Chambers','Jerry','Midway',145476,613.9599914550781,-12989.0900144577
'Chapman','Daniel','Midway',206705,5262.839904785156,-19608.11999511719
'Chavez','William','Midway',10161,5569.47981262207,-10971.40005493164
'Chavez','William','Midway',10161,0,-2472.8701171875
'Chavis','Erik','Midway',141627,2261.490005493164,-7108.670036315918
'Child','Emily','Midway',50297,1619.519981384277,-15503.68030619621
'Clark','Melissa','Midway',27844,2832.499877929688,-21105.37027740479
'Clay','Sally','Fairview',87955,2545.880088806152,-19810.05996704102
'Clemons','Cesar','Midway',207603,6.289999961853027,1394.180068969727
'Clifford','Bessie','Midway',61376,6625.749826431274,-11595.60971832275
'Collins','Virgie','Midway',124655,2334.069923400879,-7378.079978942871
'Corona','Jose','Fairview',119316,223.2599945068359,-8779.220096588135
'Cortez','Stanley','Midway',82125,6180.700073242188,-15051.41018867493
'Cox','Glenn','Midway',178104,3702.43994140625,-16194.96003723145
'Crawford','Ralph','Fairview',184125,6848.91015625,-11875.35998535156
'Crouch','Vivian','Fairview',100177,8274.530259370804,-15809.709897995
'Cruz','Judy','Midway',158242,460.4200134277344,-21659.86986541748
'Culpepper','Karl','Midway',102332,2867.109924316406,-4059.469982147217
'Curtis','Lori','Midway',11896,0,-9689.089744567871
'Damico','Zachary','Midway',77549,4091.2900390625,-8512.919979095459
'Daniel','Denise','Midway',38236,7390.880031108856,-18976.98042297363
---- TYPES
STRING, STRING, STRING, INT, DOUBLE, DOUBLE
====